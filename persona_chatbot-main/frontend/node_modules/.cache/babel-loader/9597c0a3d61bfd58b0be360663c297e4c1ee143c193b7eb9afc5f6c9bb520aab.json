{"ast":null,"code":"import axios from 'axios';\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:8000';\n\n// Create axios instance with default config\nconst axiosInstance = axios.create({\n  baseURL: API_URL\n});\n// Add response interceptor for handling auth errors\naxiosInstance.interceptors.response.use(response => response, async error => {\n  var _error$response;\n  const originalRequest = error.config;\n\n  // If error is 401 and we haven't tried to refresh token yet\n  if (((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status) === 401 && !originalRequest._retry) {\n    originalRequest._retry = true;\n    try {\n      const refreshToken = localStorage.getItem('refresh_token');\n      if (!refreshToken) {\n        throw new Error('No refresh token');\n      }\n      const response = await axios.post(`${API_URL}/auth/refresh`, {\n        refresh_token: refreshToken\n      });\n      if (response.data.access_token) {\n        localStorage.setItem('token', response.data.access_token);\n        const expiryTime = new Date().getTime() + 30 * 60 * 1000;\n        localStorage.setItem('token_expiry', expiryTime.toString());\n\n        // Update Authorization header and retry request\n        originalRequest.headers['Authorization'] = `Bearer ${response.data.access_token}`;\n        return axiosInstance(originalRequest);\n      }\n    } catch (refreshError) {\n      logout();\n      return Promise.reject(refreshError);\n    }\n  }\n  return Promise.reject(error);\n});\nexport const register = async (email, password) => {\n  const response = await axiosInstance.post('/auth/register', {\n    email,\n    password\n  });\n  return response.data;\n};\nexport const login = async (email, password) => {\n  const response = await axiosInstance.post('/auth/login', {\n    email,\n    password\n  });\n  if (response.data.access_token) {\n    localStorage.setItem('token', response.data.access_token);\n    if (response.data.refresh_token) {\n      localStorage.setItem('refresh_token', response.data.refresh_token);\n    }\n    // Store expiry time (30 minutes from now)\n    const expiryTime = new Date().getTime() + 30 * 60 * 1000;\n    localStorage.setItem('token_expiry', expiryTime.toString());\n  }\n  return response.data;\n};\nexport const logout = () => {\n  localStorage.removeItem('token');\n  localStorage.removeItem('refresh_token');\n  localStorage.removeItem('token_expiry');\n  window.location.href = '/login';\n};\nexport const isTokenExpired = () => {\n  const expiryTime = localStorage.getItem('token_expiry');\n  if (!expiryTime) return true;\n  return new Date().getTime() > parseInt(expiryTime);\n};\nexport const getToken = () => {\n  const token = localStorage.getItem('token');\n  if (!token || isTokenExpired()) {\n    logout();\n    return null;\n  }\n  return token;\n};\nexport const getCurrentUser = async () => {\n  const token = getToken();\n  if (!token) return null;\n  try {\n    const response = await axiosInstance.get('/auth/me', {\n      headers: {\n        'Authorization': `Bearer ${token}`\n      }\n    });\n    return response.data;\n  } catch (error) {\n    var _error$response2;\n    if (axios.isAxiosError(error) && ((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : _error$response2.status) === 401) {\n      logout();\n    }\n    return null;\n  }\n};\nexport const loginWithGoogle = async () => {\n  try {\n    // Get authorization URL from backend\n    const response = await axiosInstance.get('/auth/google/login');\n    const authUrl = response.data.authorization_url;\n\n    // Redirect to Google OAuth\n    window.location.href = authUrl;\n  } catch (error) {\n    throw new Error('Failed to initiate Google login');\n  }\n};\nexport const handleGoogleCallback = async code => {\n  try {\n    const response = await axiosInstance.post('/auth/google/token', {\n      code: code\n    });\n    if (response.data.access_token) {\n      localStorage.setItem('token', response.data.access_token);\n      if (response.data.refresh_token) {\n        localStorage.setItem('refresh_token', response.data.refresh_token);\n      }\n      // Store expiry time (30 minutes from now)\n      const expiryTime = new Date().getTime() + 30 * 60 * 1000;\n      localStorage.setItem('token_expiry', expiryTime.toString());\n    }\n    return response.data;\n  } catch (error) {\n    if (axios.isAxiosError(error)) {\n      var _error$response3, _error$response3$data;\n      throw new Error(((_error$response3 = error.response) === null || _error$response3 === void 0 ? void 0 : (_error$response3$data = _error$response3.data) === null || _error$response3$data === void 0 ? void 0 : _error$response3$data.detail) || 'Google authentication failed');\n    }\n    throw new Error('Google authentication failed');\n  }\n};","map":{"version":3,"names":["axios","API_URL","process","env","REACT_APP_API_URL","axiosInstance","create","baseURL","interceptors","response","use","error","_error$response","originalRequest","config","status","_retry","refreshToken","localStorage","getItem","Error","post","refresh_token","data","access_token","setItem","expiryTime","Date","getTime","toString","headers","refreshError","logout","Promise","reject","register","email","password","login","removeItem","window","location","href","isTokenExpired","parseInt","getToken","token","getCurrentUser","get","_error$response2","isAxiosError","loginWithGoogle","authUrl","authorization_url","handleGoogleCallback","code","_error$response3","_error$response3$data","detail"],"sources":["C:/Users/ajits/persona_chatbot1/persona_chatbot1-18497920f87bc6a34d766a62becad4ff68d85548/frontend/src/services/auth.ts"],"sourcesContent":["import axios from 'axios';\r\n\r\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:8000';\r\n\r\n// Create axios instance with default config\r\nconst axiosInstance = axios.create({\r\n    baseURL: API_URL,\r\n});\r\n\r\nexport interface AuthResponse {\r\n    access_token: string;\r\n    token_type: string;\r\n    refresh_token?: string;\r\n}\r\n\r\nexport interface User {\r\n    id: number;\r\n    email: string;\r\n    username: string;\r\n}\r\n\r\n// Add response interceptor for handling auth errors\r\naxiosInstance.interceptors.response.use(\r\n    (response) => response,\r\n    async (error) => {\r\n        const originalRequest = error.config;\r\n        \r\n        // If error is 401 and we haven't tried to refresh token yet\r\n        if (error.response?.status === 401 && !originalRequest._retry) {\r\n            originalRequest._retry = true;\r\n            \r\n            try {\r\n                const refreshToken = localStorage.getItem('refresh_token');\r\n                if (!refreshToken) {\r\n                    throw new Error('No refresh token');\r\n                }\r\n                \r\n                const response = await axios.post(`${API_URL}/auth/refresh`, {\r\n                    refresh_token: refreshToken\r\n                });\r\n                \r\n                if (response.data.access_token) {\r\n                    localStorage.setItem('token', response.data.access_token);\r\n                    const expiryTime = new Date().getTime() + 30 * 60 * 1000;\r\n                    localStorage.setItem('token_expiry', expiryTime.toString());\r\n                    \r\n                    // Update Authorization header and retry request\r\n                    originalRequest.headers['Authorization'] = `Bearer ${response.data.access_token}`;\r\n                    return axiosInstance(originalRequest);\r\n                }\r\n            } catch (refreshError) {\r\n                logout();\r\n                return Promise.reject(refreshError);\r\n            }\r\n        }\r\n        return Promise.reject(error);\r\n    }\r\n);\r\n\r\nexport const register = async (email: string, password: string): Promise<User> => {\r\n    const response = await axiosInstance.post('/auth/register', {\r\n        email,\r\n        password,\r\n    });\r\n    return response.data;\r\n};\r\n\r\nexport const login = async (email: string, password: string): Promise<AuthResponse> => {\r\n    const response = await axiosInstance.post('/auth/login', {\r\n        email,\r\n        password,\r\n    });\r\n    \r\n    if (response.data.access_token) {\r\n        localStorage.setItem('token', response.data.access_token);\r\n        if (response.data.refresh_token) {\r\n            localStorage.setItem('refresh_token', response.data.refresh_token);\r\n        }\r\n        // Store expiry time (30 minutes from now)\r\n        const expiryTime = new Date().getTime() + 30 * 60 * 1000;\r\n        localStorage.setItem('token_expiry', expiryTime.toString());\r\n    }\r\n    \r\n    return response.data;\r\n};\r\n\r\nexport const logout = () => {\r\n    localStorage.removeItem('token');\r\n    localStorage.removeItem('refresh_token');\r\n    localStorage.removeItem('token_expiry');\r\n    window.location.href = '/login';\r\n};\r\n\r\nexport const isTokenExpired = (): boolean => {\r\n    const expiryTime = localStorage.getItem('token_expiry');\r\n    if (!expiryTime) return true;\r\n    \r\n    return new Date().getTime() > parseInt(expiryTime);\r\n};\r\n\r\nexport const getToken = (): string | null => {\r\n    const token = localStorage.getItem('token');\r\n    if (!token || isTokenExpired()) {\r\n        logout();\r\n        return null;\r\n    }\r\n    return token;\r\n};\r\n\r\nexport const getCurrentUser = async (): Promise<User | null> => {\r\n    const token = getToken();\r\n    if (!token) return null;\r\n    \r\n    try {\r\n        const response = await axiosInstance.get('/auth/me', {\r\n            headers: {\r\n                'Authorization': `Bearer ${token}`\r\n            }\r\n        });\r\n        return response.data;\r\n    } catch (error) {\r\n        if (axios.isAxiosError(error) && error.response?.status === 401) {\r\n            logout();\r\n        }\r\n        return null;\r\n    }\r\n};\r\n\r\nexport const loginWithGoogle = async (): Promise<void> => {\r\n    try {\r\n        // Get authorization URL from backend\r\n        const response = await axiosInstance.get('/auth/google/login');\r\n        const authUrl = response.data.authorization_url;\r\n        \r\n        // Redirect to Google OAuth\r\n        window.location.href = authUrl;\r\n    } catch (error) {\r\n        throw new Error('Failed to initiate Google login');\r\n    }\r\n};\r\n\r\nexport const handleGoogleCallback = async (code: string): Promise<AuthResponse> => {\r\n    try {\r\n        const response = await axiosInstance.post('/auth/google/token', {\r\n            code: code\r\n        });\r\n        \r\n        if (response.data.access_token) {\r\n            localStorage.setItem('token', response.data.access_token);\r\n            if (response.data.refresh_token) {\r\n                localStorage.setItem('refresh_token', response.data.refresh_token);\r\n            }\r\n            // Store expiry time (30 minutes from now)\r\n            const expiryTime = new Date().getTime() + 30 * 60 * 1000;\r\n            localStorage.setItem('token_expiry', expiryTime.toString());\r\n        }\r\n        \r\n        return response.data;\r\n    } catch (error) {\r\n        if (axios.isAxiosError(error)) {\r\n            throw new Error(error.response?.data?.detail || 'Google authentication failed');\r\n        }\r\n        throw new Error('Google authentication failed');\r\n    }\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}